// Backbone.js 0.5.3
// (c) 2010 Jeremy Ashkenas, DocumentCloud Inc.
// Backbone may be freely distributed under the MIT license.
// For all details and documentation:
// http://documentcloud.github.com/backbone

(function(e,t){typeof exports!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","jquery","exports"],function(n,r,i){t(e,i,n,r)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender)})(this,function(e,t,n,r){var i=e.Backbone,s=Array.prototype.slice;t.VERSION="0.5.3",t.noConflict=function(){return e.Backbone=i,t},t.emulateHTTP=!1,t.emulateJSON=!1,t.Events={bind:function(e,t,n){var r=this._callbacks||(this._callbacks={}),i=r[e]||(r[e]={}),s=i.tail||(i.tail=i.next={});return s.callback=t,s.context=n,i.tail=s.next={},this},unbind:function(e,t){var n,r,i;if(!e)this._callbacks=null;else if(n=this._callbacks)if(!t)n[e]={};else if(r=n[e])while((i=r)&&(r=r.next)){if(r.callback!==t)continue;i.next=r.next,r.context=r.callback=null;break}return this},trigger:function(e){var t,n,r,i,o,u=["all",e];if(!(n=this._callbacks))return this;while(o=u.pop()){if(!(t=n[o]))continue;i=o=="all"?arguments:s.call(arguments,1);while(t=t.next)(r=t.callback)&&r.apply(t.context||this,i)}return this}},t.Model=function(e,t){var r;e||(e={});if(r=this.defaults)n.isFunction(r)&&(r=r.call(this)),e=n.extend({},r,e);this.attributes={},this._escapedAttributes={},this.cid=n.uniqueId("c"),this.set(e,{silent:!0}),this._changed=!1,this._previousAttributes=n.clone(this.attributes),t&&t.collection&&(this.collection=t.collection),this.initialize(e,t)},n.extend(t.Model.prototype,t.Events,{_changed:!1,idAttribute:"id",initialize:function(){},toJSON:function(){return n.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var r=this.attributes[e];return this._escapedAttributes[e]=n.escape(r==null?"":""+r)},has:function(e){return this.attributes[e]!=null},set:function(e,t){t||(t={});if(!e)return this;e.attributes&&(e=e.attributes);var r=this.attributes,i=this._escapedAttributes;if(!t.silent&&this.validate&&!this._performValidation(e,t))return!1;this.idAttribute in e&&(this.id=e[this.idAttribute]);var s=this._changing;this._changing=!0;for(var o in e){var u=e[o];n.isEqual(r[o],u)||(r[o]=u,delete i[o],this._changed=!0,t.silent||this.trigger("change:"+o,this,u,t))}return s||(!t.silent&&this._changed&&this.change(t),this._changing=!1),this},unset:function(e,t){if(e in this.attributes){t||(t={});var n=this.attributes[e],r={};return r[e]=void 0,!t.silent&&this.validate&&!this._performValidation(r,t)?!1:((this._unsetAttributes||(this._unsetAttributes=[])).push(e),delete this.attributes[e],delete this._escapedAttributes[e],e==this.idAttribute&&delete this.id,this._changed=!0,t.silent||(this.trigger("change:"+e,this,void 0,t),this.change(t)),this)}return this},clear:function(e){e||(e={});var t,n=this.attributes,r={};for(t in n)r[t]=void 0;if(!e.silent&&this.validate&&!this._performValidation(r,e))return!1;this.attributes={},this._escapedAttributes={},this._changed=!0;if(!e.silent){for(t in n)this.trigger("change:"+t,this,void 0,e);this.change(e)}return this},fetch:function(e){e||(e={});var n=this,r=e.success;return e.success=function(t,i,s){if(!n.set(n.parse(t,s),e))return!1;r&&r(n,t)},e.error=S(e.error,n,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,n){n||(n={});if(e&&!this.set(e,n))return!1;var r=this,i=n.success;n.success=function(e,t,s){if(!r.set(r.parse(e,s),n))return!1;i&&i(r,e,s)},n.error=S(n.error,r,n);var s=this.isNew()?"create":"update";return(this.sync||t.sync).call(this,s,this,n)},destroy:function(e){e||(e={});if(this.isNew())return this.trigger("destroy",this,this.collection,e);var n=this,r=e.success;return e.success=function(t){n.trigger("destroy",n,n.collection,e),r&&r(n,t)},e.error=S(e.error,n,e),(this.sync||t.sync).call(this,"delete",this,e)},url:function(){var e=w(this.collection)||this.urlRoot||E();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(e){this.trigger("change",this,e),this._previousAttributes=n.clone(this.attributes),this._unsetAttributes=null,this._changed=!1},hasChanged:function(e){return e?this._previousAttributes[e]!=this.attributes[e]:this._changed},changedAttributes:function(e){e||(e=this.attributes);var t=this._previousAttributes,r=this._unsetAttributes,i=!1;for(var s in e)n.isEqual(t[s],e[s])||(i||(i={}),i[s]=e[s]);if(r){i||(i={});var o=r.length;while(o--)i[r[o]]=void 0}return i},previous:function(e){return!e||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},_performValidation:function(e,t){var n=this.validate(e);return n?(t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}}),t.Collection=function(e,t){t||(t={}),t.comparator&&(this.comparator=t.comparator),n.bindAll(this,"_onModelEvent","_removeReference"),this._reset(),e&&this.reset(e,{silent:!0}),this.initialize.apply(this,arguments)},n.extend(t.Collection.prototype,t.Events,{model:t.Model,initialize:function(){},toJSON:function(){return this.map(function(e){return e.toJSON()})},add:function(e,t){if(n.isArray(e))for(var r=0,i=e.length;r<i;r++)this._add(e[r],t);else this._add(e,t);return this},remove:function(e,t){if(n.isArray(e))for(var r=0,i=e.length;r<i;r++)this._remove(e[r],t);else this._remove(e,t);return this},get:function(e){return e==null?null:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return this.models=this.sortBy(this.comparator),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return n.map(this.models,function(t){return t.get(e)})},reset:function(e,t){return e||(e=[]),t||(t={}),this.each(this._removeReference),this._reset(),this.add(e,{silent:!0}),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e||(e={});var n=this,r=e.success;return e.success=function(t,i,s){n[e.add?"add":"reset"](n.parse(t,s),e),r&&r(n,t)},e.error=S(e.error,n,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(e,t){var n=this;t||(t={}),e=this._prepareModel(e,t);if(!e)return!1;var r=t.success;return t.success=function(e,i,s){n.add(e,t),r&&r(e,i,s)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return n(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,n){if(e instanceof t.Model)e.collection||(e.collection=this);else{var r=e;e=new this.model(r,{collection:this}),e.validate&&!e._performValidation(e.attributes,n)&&(e=!1)}return e},_add:function(e,t){t||(t={}),e=this._prepareModel(e,t);if(!e)return!1;var n=this.getByCid(e);if(n)throw new Error(["Can't add the same model to a set twice",n.id]);this._byId[e.id]=e,this._byCid[e.cid]=e;var r=t.at!=null?t.at:this.comparator?this.sortedIndex(e,this.comparator):this.length;return this.models.splice(r,0,e),e.bind("all",this._onModelEvent),this.length++,t.index=r,t.silent||e.trigger("add",e,this,t),e},_remove:function(e,t){t||(t={}),e=this.getByCid(e)||this.get(e);if(!e)return null;delete this._byId[e.id],delete this._byCid[e.cid];var n=this.indexOf(e);return this.models.splice(n,1),this.length--,t.index=n,t.silent||e.trigger("remove",e,this,t),this._removeReference(e),e},_removeReference:function(e){this==e.collection&&delete e.collection,e.unbind("all",this._onModelEvent)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this._remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var o=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"];n.each(o,function(e){t.Collection.prototype[e]=function(){return n[e].apply(n,[this.models].concat(n.toArray(arguments)))}}),t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var u=/:([\w\d]+)/g,a=/\*([\w\d]+)/g,f=/[-[\]{}()+?.,\\^$|#\s]/g;n.extend(t.Router.prototype,t.Events,{initialize:function(){},route:function(e,r,i){t.history||(t.history=new t.History),n.isRegExp(e)||(e=this._routeToRegExp(e)),t.history.route(e,n.bind(function(t){var n=this._extractParameters(e,t);i&&i.apply(this,n),this.trigger.apply(this,["route:"+r].concat(n))},this))},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(f,"\\$&").replace(u,"([^/]*)").replace(a,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}}),t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl")};var l=/^#*/,c=/msie [\w.]+/,h=!1;n.extend(t.History.prototype,{interval:50,getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=window.location.hash;return e=decodeURIComponent(e.replace(l,"")),e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e},start:function(e){if(h)throw new Error("Backbone.history has already been started");this.options=n.extend({},{root:"/"},this.options,e),this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),i=document.documentMode,s=c.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);s&&(this.iframe=r('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?r(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!s?r(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval),this.fragment=t,h=!0;var o=window.location,u=o.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=o.hash.replace(l,""),window.history.replaceState({},document.title,o.protocol+"//"+o.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.iframe.location.hash));if(t==this.fragment||t==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return r},navigate:function(e,t){var n=(e||"").replace(l,"");if(this.fragment==n||this.fragment==decodeURIComponent(n))return;if(this._hasPushState){var r=window.location;n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history.pushState({},document.title,r.protocol+"//"+r.host+n)}else window.location.hash=this.fragment=n,this.iframe&&n!=this.getFragment(this.iframe.location.hash)&&(this.iframe.document.open().close(),this.iframe.location.hash=n);t&&this.loadUrl(e)}}),t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.delegateEvents(),this.initialize.apply(this,arguments)};var p=function(e){return r(e,this.el)},d=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName"];n.extend(t.View.prototype,t.Events,{tagName:"div",$:p,initialize:function(){},render:function(){return this},remove:function(){return r(this.el).remove(),this},make:function(e,t,n){var i=document.createElement(e);return t&&r(i).attr(t),n&&r(i).html(n),i},delegateEvents:function(e){if(!e&&!(e=this.events))return;n.isFunction(e)&&(e=e.call(this)),this.undelegateEvents();for(var t in e){var i=this[e[t]];if(!i)throw new Error('Event "'+e[t]+'" does not exist');var s=t.match(d),o=s[1],u=s[2];i=n.bind(i,this),o+=".delegateEvents"+this.cid,u===""?r(this.el).bind(o,i):r(this.el).delegate(u,o,i)}},undelegateEvents:function(){r(this.el).unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=n.extend({},this.options,e));for(var t=0,r=v.length;t<r;t++){var i=v[t];e[i]&&(this[i]=e[i])}this.options=e},_ensureElement:function(){if(!this.el){var e=this.attributes||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.el=this.make(this.tagName,e)}else n.isString(this.el)&&(this.el=r(this.el).get(0))}});var m=function(e,t){var n=b(this,e,t);return n.extend=this.extend,n};t.Model.extend=t.Collection.extend=t.Router.extend=t.View.extend=m;var g={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,s){var o=g[e],u={type:o,dataType:"json"};return s.url||(u.url=w(i)||E()),!s.data&&i&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),t.emulateHTTP&&(o==="PUT"||o==="DELETE")&&(t.emulateJSON&&(u.data._method=o),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",o)}),u.type!=="GET"&&!t.emulateJSON&&(u.processData=!1),r.ajax(n.extend(u,s))};var y=function(){},b=function(e,t,r){var i;return t&&t.hasOwnProperty("constructor")?i=t.constructor:i=function(){return e.apply(this,arguments)},n.extend(i,e),y.prototype=e.prototype,i.prototype=new y,t&&n.extend(i.prototype,t),r&&n.extend(i,r),i.prototype.constructor=i,i.__super__=e.prototype,i},w=function(e){return!e||!e.url?null:n.isFunction(e.url)?e.url():e.url},E=function(){throw new Error('A "url" property or function must be specified')},S=function(e,t,n){return function(r,i){var i=r===t?i:r;e?e(r,i,n):t.trigger("error",r,i,n)}};return t});